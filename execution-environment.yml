version: 3

images:
  base_image:
    name: quay.io/centos/centos:stream9

dependencies:
  ansible_core:
    package_pip: ansible-core==2.20.*
  ansible_runner:
    package_pip: ansible-runner

  galaxy: requirements.yml
  python: requirements.txt
  system: bindep.txt

additional_build_steps:
  prepend_base:
    # Ensure TLS trust store exists BEFORE any pip installs
    - RUN dnf -y install ca-certificates && dnf clean all

    # Make pip modern BEFORE ansible-builder installs ansible-core
    - RUN python3 -m pip install -U pip setuptools wheel

    # Force public PyPI (or replace with your mirror URL)
    - ENV PIP_INDEX_URL=https://pypi.org/simple
    - ENV PIP_EXTRA_INDEX_URL=
